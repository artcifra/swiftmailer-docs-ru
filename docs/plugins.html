<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" >
    <head>
        <meta name="keywords" content="swift mailer, swiftmailer, swiftmail, php mailer, phpmailer, oop mailer, bulk emailing" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <link href="../css/global.css" media="screen" rel="stylesheet" type="text/css" />
        <link href="../css/homepage.css" media="screen" rel="stylesheet" type="text/css" />
        <link href="../css/download.css" media="screen" rel="stylesheet" type="text/css" />
        <link href="../css/documentation.css" media="screen" rel="stylesheet" type="text/css" />
        <link href="../css/pygments.css" media="screen" rel="stylesheet" type="text/css" />
        <link href="../css/code.css" media="screen" rel="stylesheet" type="text/css" />

        <title>Plugins &#8211; Documentation &#8211; Swift Mailer</title>

        <script type="text/javascript">
            var _gaq = _gaq || [];
        </script>
  </head>
  <body>
  <a href="https://github.com/ruden/swiftmailer-docs-ru"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/82b228a3648bf44fc1163ef44c62fcc60081495e/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_red_aa0000.png"></a>
    <div id="layoutcontainer">
      
    <div id="layout">
      
      <div id="header" class="corners top right left">
        <div id="headercontent">
          <img id="logo" src="../images/logo.png" alt="Swift Mailer" />
          
          <div id="navigation">
            <ul>
              <li><a href="/swiftmailer-docs-ru/">Главная</a></li>
              <li><a href="/swiftmailer-docs-ru/download.html">Установка</a></li>
              <li><a href="/swiftmailer-docs-ru/docs/introduction.html">Документация</a></li>
              <li><a href="/swiftmailer-docs-ru/bugs.html">Ошибки</a></li>
              <li class="tab corners top right left"><a class="download-file" href="/swiftmailer-docs-ru/download.html">текущий 6.0.2</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div id="wrapper" class="corners bottom right left">

          <div>
              <div id="container">
                  <div id="content">
                          <div id="doc" class="body-web">
        <div class="section" id="plugins">
<h1>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h1>
<p>Plugins exist to extend, or modify the behaviour of Swift Mailer. They respond
to Events that are fired within the Transports during sending.</p>
<p>There are a number of Plugins provided as part of the base Swift Mailer package
and they all follow a common interface to respond to Events fired within the
library. Interfaces are provided to &quot;listen&quot; to each type of Event fired and to
act as desired when a listened-to Event occurs.</p>
<p>Although several plugins are provided with Swift Mailer out-of-the-box, the
Events system has been specifically designed to make it easy for experienced
object-oriented developers to write their own plugins in order to achieve
goals that may not be possible with the base library.</p>
<div class="section" id="antiflood-plugin">
<h2>AntiFlood Plugin<a class="headerlink" href="#antiflood-plugin" title="Permalink to this headline">¶</a></h2>
<p>Many SMTP servers have limits on the number of messages that may be sent during
any single SMTP connection. The AntiFlood plugin provides a way to stay within
this limit while still managing a large number of emails.</p>
<p>A typical limit for a single connection is 100 emails. If the server you
connect to imposes such a limit, it expects you to disconnect after that number
of emails has been sent. You could manage this manually within a loop, but the
AntiFlood plugin provides the necessary wrapper code so that you don't need to
worry about this logic.</p>
<p>Regardless of limits imposed by the server, it's usually a good idea to be
conservative with the resources of the SMTP server. Sending will become
sluggish if the server is being over-used so using the AntiFlood plugin will
not be a bad idea even if no limits exist.</p>
<p>The AntiFlood plugin's logic is basically to disconnect and the immediately
re-connect with the SMTP server every X number of emails sent, where X is a
number you specify to the plugin.</p>
<p>You can also specify a time period in seconds that Swift Mailer should pause
for between the disconnect/re-connect process. It's a good idea to pause for a
short time (say 30 seconds every 100 emails) simply to give the SMTP server a
chance to process its queue and recover some resources.</p>
<div class="section" id="using-the-antiflood-plugin">
<h3>Using the AntiFlood Plugin<a class="headerlink" href="#using-the-antiflood-plugin" title="Permalink to this headline">¶</a></h3>
<p>The AntiFlood Plugin -- like all plugins -- is added with the Mailer class's
<code class="notranslate">registerPlugin()</code> method. It takes two constructor parameters: the number of
emails to pause after, and optionally the number of seconds to pause for.</p>
<p>When Swift Mailer sends messages it will count the number of messages that have
been sent since the last re-connect. Once the number hits your specified
threshold it will disconnect and re-connect, optionally pausing for a specified
amount of time:</p>
<div class="literal-block notranslate"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Create the Mailer using any Transport</span>
<span class="nv">$mailer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Swift_Mailer</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">Swift_SmtpTransport</span><span class="p">(</span><span class="s1">&#39;smtp.example.org&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Use AntiFlood to re-connect after 100 emails</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="k">new</span> <span class="nx">Swift_Plugins_AntiFloodPlugin</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>

<span class="c1">// And specify a time in seconds to pause for (30 secs)</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="k">new</span> <span class="nx">Swift_Plugins_AntiFloodPlugin</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>

<span class="c1">// Continue sending as normal</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$lotsOfRecipients</span> <span class="k">as</span> <span class="nv">$recipient</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">...</span>

  <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span> <span class="o">...</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="throttler-plugin">
<h2>Throttler Plugin<a class="headerlink" href="#throttler-plugin" title="Permalink to this headline">¶</a></h2>
<p>If your SMTP server has restrictions in place to limit the rate at which you
send emails, then your code will need to be aware of this rate-limiting. The
Throttler plugin makes Swift Mailer run at a rate-limited speed.</p>
<p>Many shared hosts don't open their SMTP servers as a free-for-all. Usually they
have policies in place (probably to discourage spammers) that only allow you to
send a fixed number of emails per-hour/day.</p>
<p>The Throttler plugin supports two modes of rate-limiting and with each, you
will need to do that math to figure out the values you want. The plugin can
limit based on the number of emails per minute, or the number of
bytes-transferred per-minute.</p>
<div class="section" id="using-the-throttler-plugin">
<h3>Using the Throttler Plugin<a class="headerlink" href="#using-the-throttler-plugin" title="Permalink to this headline">¶</a></h3>
<p>The Throttler Plugin -- like all plugins -- is added with the Mailer class'
<code class="notranslate">registerPlugin()</code> method. It has two required constructor parameters that
tell it how to do its rate-limiting.</p>
<p>When Swift Mailer sends messages it will keep track of the rate at which
sending messages is occurring. If it realises that sending is happening too
fast, it will cause your program to <code class="notranslate">sleep()</code> for enough time to average out
the rate:</p>
<div class="literal-block notranslate"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Create the Mailer using any Transport</span>
<span class="nv">$mailer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Swift_Mailer</span><span class="p">(</span>
  <span class="k">new</span> <span class="nx">Swift_SmtpTransport</span><span class="p">(</span><span class="s1">&#39;smtp.example.org&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Rate limit to 100 emails per-minute</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="k">new</span> <span class="nx">Swift_Plugins_ThrottlerPlugin</span><span class="p">(</span>
  <span class="mi">100</span><span class="p">,</span> <span class="nx">Swift_Plugins_ThrottlerPlugin</span><span class="o">::</span><span class="na">MESSAGES_PER_MINUTE</span>
<span class="p">));</span>

<span class="c1">// Rate limit to 10MB per-minute</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="k">new</span> <span class="nx">Swift_Plugins_ThrottlerPlugin</span><span class="p">(</span>
  <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span> <span class="nx">Swift_Plugins_ThrottlerPlugin</span><span class="o">::</span><span class="na">BYTES_PER_MINUTE</span>
<span class="p">));</span>

<span class="c1">// Continue sending as normal</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$lotsOfRecipients</span> <span class="k">as</span> <span class="nv">$recipient</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">...</span>

  <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span> <span class="o">...</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="logger-plugin">
<h2>Logger Plugin<a class="headerlink" href="#logger-plugin" title="Permalink to this headline">¶</a></h2>
<p>The Logger plugins helps with debugging during the process of sending. It can
help to identify why an SMTP server is rejecting addresses, or any other
hard-to-find problems that may arise.</p>
<p>The Logger plugin comes in two parts. There's the plugin itself, along with one
of a number of possible Loggers that you may choose to use. For example, the
logger may output messages directly in realtime, or it may capture messages in
an array.</p>
<p>One other notable feature is the way in which the Logger plugin changes
Exception messages. If Exceptions are being thrown but the error message does
not provide conclusive information as to the source of the problem (such as an
ambiguous SMTP error) the Logger plugin includes the entire SMTP transcript in
the error message so that debugging becomes a simpler task.</p>
<p>There are a few available Loggers included with Swift Mailer, but writing your
own implementation is incredibly simple and is achieved by creating a short
class that implements the <code class="notranslate">Swift_Plugins_Logger</code> interface.</p>
<ul class="simple">
<li><code class="notranslate">Swift_Plugins_Loggers_ArrayLogger</code>: Keeps a collection of log messages
inside an array. The array content can be cleared or dumped out to the screen.</li>
<li><code class="notranslate">Swift_Plugins_Loggers_EchoLogger</code>: Prints output to the screen in
realtime. Handy for very rudimentary debug output.</li>
</ul>
<div class="section" id="using-the-logger-plugin">
<h3>Using the Logger Plugin<a class="headerlink" href="#using-the-logger-plugin" title="Permalink to this headline">¶</a></h3>
<p>The Logger Plugin -- like all plugins -- is added with the Mailer class'
<code class="notranslate">registerPlugin()</code> method. It accepts an instance of <code class="notranslate">Swift_Plugins_Logger</code>
in its constructor.</p>
<p>When Swift Mailer sends messages it will keep a log of all the interactions
with the underlying Transport being used. Depending upon the Logger that has
been used the behaviour will differ, but all implementations offer a way to get
the contents of the log:</p>
<div class="literal-block notranslate"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Create the Mailer using any Transport</span>
<span class="nv">$mailer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Swift_Mailer</span><span class="p">(</span>
 <span class="k">new</span> <span class="nx">Swift_SmtpTransport</span><span class="p">(</span><span class="s1">&#39;smtp.example.org&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// To use the ArrayLogger</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Swift_Plugins_Loggers_ArrayLogger</span><span class="p">();</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="k">new</span> <span class="nx">Swift_Plugins_LoggerPlugin</span><span class="p">(</span><span class="nv">$logger</span><span class="p">));</span>

<span class="c1">// Or to use the Echo Logger</span>
<span class="nv">$logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Swift_Plugins_Loggers_EchoLogger</span><span class="p">();</span>
<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="k">new</span> <span class="nx">Swift_Plugins_LoggerPlugin</span><span class="p">(</span><span class="nv">$logger</span><span class="p">));</span>

<span class="c1">// Continue sending as normal</span>
<span class="k">for</span> <span class="p">(</span><span class="nv">$lotsOfRecipients</span> <span class="k">as</span> <span class="nv">$recipient</span><span class="p">)</span> <span class="p">{</span>
 <span class="o">...</span>

 <span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">(</span> <span class="o">...</span> <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Dump the log contents</span>
<span class="c1">// NOTE: The EchoLogger dumps in realtime so dump() does nothing for it</span>
<span class="k">echo</span> <span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">dump</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="decorator-plugin">
<h2>Decorator Plugin<a class="headerlink" href="#decorator-plugin" title="Permalink to this headline">¶</a></h2>
<p>Often there's a need to send the same message to multiple recipients, but with
tiny variations such as the recipient's name being used inside the message
body. The Decorator plugin aims to provide a solution for allowing these small
differences.</p>
<p>The decorator plugin works by intercepting the sending process of Swift Mailer,
reading the email address in the To: field and then looking up a set of
replacements for a template.</p>
<p>While the use of this plugin is simple, it is probably the most commonly
misunderstood plugin due to the way in which it works. The typical mistake
users make is to try registering the plugin multiple times (once for each
recipient) -- inside a loop for example. This is incorrect.</p>
<p>The Decorator plugin should be registered just once, but containing the list of
all recipients prior to sending. It will use this list of recipients to find
the required replacements during sending.</p>
<div class="section" id="using-the-decorator-plugin">
<h3>Using the Decorator Plugin<a class="headerlink" href="#using-the-decorator-plugin" title="Permalink to this headline">¶</a></h3>
<p>To use the Decorator plugin, simply create an associative array of replacements
based on email addresses and then use the mailer's <code class="notranslate">registerPlugin()</code> method
to add the plugin.</p>
<p>First create an associative array of replacements based on the email addresses
you'll be sending the message to.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p>The replacements array becomes a 2-dimensional array whose keys are the
email addresses and whose values are an associative array of replacements
for that email address. The curly braces used in this example can be any
type of syntax you choose, provided they match the placeholders in your
email template:</p>
<div class="literal-block notranslate"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$replacements</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$replacements</span><span class="p">[</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;{username}&#39;</span><span class="o">=&gt;</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
    <span class="s1">&#39;{resetcode}&#39;</span><span class="o">=&gt;</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;resetcode&#39;</span><span class="p">]</span>
  <span class="p">];</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
<p>Now create an instance of the Decorator plugin using this array of replacements
and then register it with the Mailer. Do this only once!</p>
<div class="literal-block notranslate"><div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$decorator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Swift_Plugins_DecoratorPlugin</span><span class="p">(</span><span class="nv">$replacements</span><span class="p">);</span>

<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="nv">$decorator</span><span class="p">);</span>
</pre></div>
</div></div>
<p>When you create your message, replace elements in the body (and/or the subject
line) with your placeholders:</p>
<div class="literal-block notranslate"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$message</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Swift_Message</span><span class="p">())</span>
  <span class="o">-&gt;</span><span class="na">setSubject</span><span class="p">(</span><span class="s1">&#39;Important notice for {username}&#39;</span><span class="p">)</span>
  <span class="o">-&gt;</span><span class="na">setBody</span><span class="p">(</span>
    <span class="s2">&quot;Hello {username}, you requested to reset your password.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">.</span>
    <span class="s2">&quot;Please visit https://example.com/pwreset and use the reset code {resetcode} to set a new password.&quot;</span>
  <span class="p">)</span>
  <span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">$message</span><span class="o">-&gt;</span><span class="na">addTo</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>When you send this message to each of your recipients listed in your
<code class="notranslate">$replacements</code> array they will receive a message customized for just
themselves. For example, the message used above when received may appear like
this to one user:</p>
<div class="literal-block notranslate"><div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Subject: Important notice for smilingsunshine2009

Hello smilingsunshine2009,you requested to reset your password.
Please visit https://example.com/pwreset and use the reset code 183457 to set a new password.
</pre></div>
</td></tr></table></div></div>
<p>While another use may receive the message as:</p>
<div class="literal-block notranslate"><div class="highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>Subject: Important notice for billy-bo-bob

Hello billy-bo-bob, you requested to reset your password.
Please visit https://example.com/pwreset and use the reset code 539127 to set a new password.
</pre></div>
</td></tr></table></div></div>
<p>While the decorator plugin provides a means to solve this problem, there are
various ways you could tackle this problem without the need for a plugin. We're
trying to come up with a better way ourselves and while we have several
(obvious) ideas we don't quite have the perfect solution to go ahead and
implement it. Watch this space.</p>
</div>
<div class="section" id="providing-your-own-replacements-lookup-for-the-decorator">
<h3>Providing Your Own Replacements Lookup for the Decorator<a class="headerlink" href="#providing-your-own-replacements-lookup-for-the-decorator" title="Permalink to this headline">¶</a></h3>
<p>Filling an array with replacements may not be the best solution for providing
replacement information to the decorator. If you have a more elegant algorithm
that performs replacement lookups on-the-fly you may provide your own
implementation.</p>
<p>Providing your own replacements lookup implementation for the Decorator is
simply a matter of passing an instance of
<code class="notranslate">Swift_Plugins_Decorator_Replacements</code> to the decorator plugin's constructor,
rather than passing in an array.</p>
<p>The Replacements interface is very simple to implement since it has just one
method: <code class="notranslate">getReplacementsFor($address)</code>.</p>
<p>Imagine you want to look up replacements from a database on-the-fly, you might
provide an implementation that does this. You need to create a small class:</p>
<div class="literal-block notranslate"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DbReplacements</span> <span class="k">implements</span> <span class="nx">Swift_Plugins_Decorator_Replacements</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">getReplacementsFor</span><span class="p">(</span><span class="nv">$address</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$db</span><span class="p">;</span> <span class="c1">// Your PDO instance with a connection to your database</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span>
      <span class="s2">&quot;SELECT * FROM `users` WHERE `email` = ?&quot;</span>
    <span class="p">);</span>

    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$address</span><span class="p">]);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;{username}&#39;</span><span class="o">=&gt;</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
        <span class="s1">&#39;{resetcode}&#39;</span><span class="o">=&gt;</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;resetcode&#39;</span><span class="p">]</span>
      <span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Now all you need to do is pass an instance of your class into the Decorator
plugin's constructor instead of passing an array:</p>
<div class="literal-block notranslate"><div class="highlight-php"><div class="highlight"><pre><span></span><span class="nv">$decorator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Swift_Plugins_DecoratorPlugin</span><span class="p">(</span><span class="k">new</span> <span class="nx">DbReplacements</span><span class="p">());</span>

<span class="nv">$mailer</span><span class="o">-&gt;</span><span class="na">registerPlugin</span><span class="p">(</span><span class="nv">$decorator</span><span class="p">);</span>
</pre></div>
</div></div>
<p>For each message sent, the plugin will call your class'
<code class="notranslate">getReplacementsFor()</code> method to find the array of replacements it needs.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">If your lookup algorithm is case sensitive, you should transform the
<code class="notranslate">$address</code> argument as appropriate -- for example by passing it through
<code class="notranslate">strtolower()</code>.</p>
</div></div>
</div>
</div>
</div>

    </div>

            <div class="navigation">
                            <a accesskey="P" title="Sending Messages" href="sending.html">
                    &laquo;&nbsp;Sending Messages
                </a>
                        <span class="separator">|</span>                            <a accesskey="N" title="Using Swift Mailer for Japanese Emails" href="japanese.html">
                    Using Swift Mailer for Japanese Emails&nbsp;&raquo;
                </a>
                    </div>
                      </div>
              </div>
          </div>

          <div id="sidepanel">
                  <div id="topicmap" class="supplementary secondary">
        <div class="clearfix">
            <p>&laquo;&nbsp;<a href="/docs/index.html">Table of Contents</a></p>

            <div class="offline-docs">

                You can download the documentation for offline reading:

                <ul>
                    <li><a id="book-pdf" href="/pdf/Swiftmailer.pdf"><img src="images/pdficon.png" alt="PDF" /></a></li>
                    <li><a id="book-epub" href="/epub/Swiftmailer.epub"><img src="images/epubicon.png" alt="EPUB" /></a></li>
                </ul>

            </div>

                            <div id="doc-toc" class="infobar-box">
                    <h3>Chapter Table of Contents</h3>
                    <ul>
<li><a class="reference internal" href="#">Plugins</a><ul>
<li><a class="reference internal" href="#antiflood-plugin">AntiFlood Plugin</a><ul>
<li><a class="reference internal" href="#using-the-antiflood-plugin">Using the AntiFlood Plugin</a></li>
</ul>
</li>
<li><a class="reference internal" href="#throttler-plugin">Throttler Plugin</a><ul>
<li><a class="reference internal" href="#using-the-throttler-plugin">Using the Throttler Plugin</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logger-plugin">Logger Plugin</a><ul>
<li><a class="reference internal" href="#using-the-logger-plugin">Using the Logger Plugin</a></li>
</ul>
</li>
<li><a class="reference internal" href="#decorator-plugin">Decorator Plugin</a><ul>
<li><a class="reference internal" href="#using-the-decorator-plugin">Using the Decorator Plugin</a></li>
<li><a class="reference internal" href="#providing-your-own-replacements-lookup-for-the-decorator">Providing Your Own Replacements Lookup for the Decorator</a></li>
</ul>
</li>
</ul>
</li>
</ul>


                    <h3>Table of Contents</h3>
                    <ul>
                        <li><a href="introduction.html">Introduction</a></li>
                        <li><a href="messages.html">Creating Messages</a></li>
                        <li><a href="headers.html">Message Headers</a></li>
                        <li><a href="sending.html">Sending messages</a></li>
                        <li><a href="plugins.html">Plugins</a></li>
                        <li><a href="japanese.html">Japanese</a></li>
                    </ul>
                </div>
            
            <div class="infobar-box">
                <h3>Questions &amp; Feedback</h3>
                <div class="feedback">
                    <p>
                      <strong>Found a typo or an error?</strong><br />
                      Open a <a href="https://github.com/swiftmailer/swiftmailer/issues">ticket</a>.
                    </p>
                    <p>
                      <strong>Need support or have a technical question?</strong><br />
                      Ask support on <a href="https://stackoverflow.com/">Stack Overflow</a>.
                     </p>
                </div>

                <h3>License</h3>
                <div id="license">
                    <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" src="https://symfony.com/images/license.png" /></a>
                    Swiftmailer <span xmlns:dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/MovingImage" rel="dc:type">documentation</span> is licensed under a
                    Creative Commons Attribution-Share Alike 3.0
                    Unported <a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/">License</a>.
                </div>
            </div>
        </div>
    </div>
          </div>

        <div id="footer">
          <div id="footercontent">
            
            <div id="about">
            </div>
        
        <div id="support">
          
          <dl class="getstarted">
            <dt>Get Started</dt>
            <dd>
              <ul>
                <li><a href="/download">Download</a></li>
                <!--<li>Tutorials</li>-->
                <li><a href="/docs/introduction.html">User Guide &amp; Book</a></li>
              </ul>
            </dd>
          </dl>

          <dl class="related">
            <dt>Get Help</dt>
            <dd>
              <ul>
                <li><a href="/docs/introduction.html">Documentation</a></li>
                <li><a href="/bugs">Report a Bug</a></li>
                <li><a href="https://groups.google.com/group/swiftmailer">Google Group</a></li>
              </ul>
            </dd>
          </dl>

            </div>
            
          </div>
        </div>
        
      </div>
      
    </div>
    </div>
  </body>
</html>
